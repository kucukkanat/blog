<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Code NodeJS Modules on Browser | Kucukkanat&#39;s Nest</title>
    <meta name="description" content="javascript nodejs core modules on browser">
    
    <meta name="keywords" content="javascript crypto webpack parcel browserify netherlands amsterdam js ecmascript es6 babel">
    <link rel="preload" href="/assets/css/0.styles.b965be64.css" as="style"><link rel="preload" href="/assets/js/app.3c5f800b.js" as="script"><link rel="preload" href="/assets/js/3.d3f6afd0.js" as="script"><link rel="prefetch" href="/assets/js/2.57317719.js"><link rel="prefetch" href="/assets/js/4.9ffab9d9.js"><link rel="prefetch" href="/assets/js/5.d42bba84.js"><link rel="prefetch" href="/assets/js/6.8fca3489.js"><link rel="prefetch" href="/assets/js/7.8727a391.js"><link rel="prefetch" href="/assets/js/8.98e38300.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b965be64.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Kucukkanat's Nest</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">Home</a></li><li><a href="/posts/how-i-setup-my-pi.html" class="sidebar-link">Starting with RaspberryPi</a></li><li><a href="/posts/gpg-signing.html" class="sidebar-link">Signing git commits with GPG</a></li><li><a href="/posts/how-to-setup-gpg.html" class="sidebar-link">How to Setup GPG</a></li><li><a href="/posts/node-core-modules-on-browser.html" class="active sidebar-link">Native node modules on browser</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/posts/node-core-modules-on-browser.html#javascript-bundler-mysteries-can-we-do-that-on-browser" class="sidebar-link">Javascript bundler mysteries! Can we do that on browser ?</a></li></ul></li></ul> </div> <div class="page"> <div class="content"><h2 id="javascript-bundler-mysteries-can-we-do-that-on-browser"><a href="#javascript-bundler-mysteries-can-we-do-that-on-browser" aria-hidden="true" class="header-anchor">#</a> Javascript bundler mysteries! Can we do that on browser ?</h2> <p>So, I was working on some experimental crypto stuff today when I literally became the guy on the famous meme myself.</p> <div style="text-align:center"><img src="/assets/img/idk-why.abf87af0.png" width="300"></div> <p>The idea is to create a simple digital signature using <code>secp256k1</code>. For more info check <a href="https://en.bitcoin.it/wiki/Secp256k1" target="_blank" rel="noopener noreferrer">secp256k1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> , <a href="https://en.bitcoin.it/wiki/Elliptic_Curve_Digital_Signature_Algorithm" target="_blank" rel="noopener noreferrer">Elliptic Curve Digital Signature Algorithm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>I was trying a simple gist that will :</p> <ul><li>create a keypair</li> <li>take a message</li> <li>hash it</li> <li>sign the hash with the private key</li> <li>verify the signature with public key</li></ul> <p>Example code is here :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;crypto&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token constant">EC</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'elliptic'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ec<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">hash</span> <span class="token operator">=</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> crypto<span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">'sha256'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">&quot;hex&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// Create and initialize EC context</span>
<span class="token comment">// (better do it once and reuse it)</span>
<span class="token keyword">const</span> ec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EC</span><span class="token punctuation">(</span><span class="token string">'secp256k1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Generate keys</span>
<span class="token keyword">const</span> keys <span class="token operator">=</span> ec<span class="token punctuation">.</span><span class="token function">genKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> publicKey <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token string">&quot;hex&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> privateKey <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token string">&quot;hex&quot;</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">,</span>publicKey<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">sign</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> privateKey</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ec<span class="token punctuation">.</span><span class="token function">keyFromPrivate</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDER</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">verify</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> publicKey</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ec<span class="token punctuation">.</span><span class="token function">keyFromPublic</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">,</span> <span class="token string">&quot;hex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> signature<span class="token punctuation">)</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span>
<span class="token keyword">const</span> signature <span class="token operator">=</span> <span class="token function">sign</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>signature<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">verify</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>signature<span class="token punctuation">,</span> publicKey<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>Now I try to run my code : <code>node index.js</code> . IT WORKS!</p> <p>Afterwards, I wanted to be able to sign on the browser as well.
Since <code>crypto</code> is a core node module I wasn't expecting it first to work on browser.</p> <p>My first attempt was to use <a href="https://parceljs.org/" target="_blank" rel="noopener noreferrer">parcel-bundler<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> .</p> <ul><li>Create an <code>index.html</code></li> <li>Call <code>&lt;script src=&quot;./index.js&quot;&gt;</code> in <code>index.html</code></li> <li>Run <code>parcel index.html</code></li> <li><em>Voilá!</em> On the browser it works!</li></ul> <p>But then I was like &quot;Why does it work ?&quot;</p> <p>I wanted to know where <code>crypto</code> module was required. So added a new line to my code on top:</p> <div class="language- extra-class"><pre class="language-text"><code>const crypto = require(&quot;crypto&quot;)
console.log(require.resolve('crypto'))
const EC = require('elliptic').ec;

...

</code></pre></div><p>When I run <code>node index.js</code> that <code>console.log</code> prints the String <code>crypto</code> only. But on the browser console there was something uncanny!</p> <div style="text-align:center"><img src="/assets/img/console-log-crypto.1eb1da90.png" width="300"></div> <p>Did you see that <code>../../.config/yarn/global/node_modules/crypto-browserify/index.js</code> too ?</p> <p>I packed up my backpack, kissed me darling mother and went on an adventure of stalking code, sniffing the github repos. Even though I thought it was going to be a needle in the haystack I came across some resources which actually revealed the mystery.</p> <p>Turns out <a href="https://github.com/browserify/browserify/blob/ae01d90900b21719e9fef7bedfc4db55ea22b71a/lib/builtins.js" target="_blank" rel="noopener noreferrer">browserify<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> has a <code>builtins.js</code> that maps some of the nodejs core modules to their browser equivalents and in build-time, requires them.</p> <p>I found out <a href="https://github.com/parcel-bundler/parcel/blob/master/packages/core/parcel-bundler/src/builtins/index.js#L1" target="_blank" rel="noopener noreferrer">parcel<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and <a href="https://github.com/webpack/webpack/blob/573d2da1d946b59ef6990cea0edf31958d13c0d6/lib/node/NodeSourcePlugin.js" target="_blank" rel="noopener noreferrer">webpack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> use a webpack-core library called <code>node-libs-browser</code> to replace those modules with their browser equivalents.</p> <p>I couldn't find any explanation about this <em>feature</em> in any of their documentation. Even though it bugs me to find out there is some magic happening behind the curtains, sometimes it is nice to have those kind of out of the box features. This feature did not only saved me time, but also added fun to this evening!</p> <p>Peace!</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/posts/how-to-setup-gpg.html" class="prev">
          How to Setup GPG
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.3c5f800b.js" defer></script><script src="/assets/js/3.d3f6afd0.js" defer></script>
  </body>
</html>
